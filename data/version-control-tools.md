## version-control-tools MD table
Generated on: 2019-08-08 13:21:50 UTC

| Commit Number | Commiter | Commit Message | Commit Url | Date | 
|:-----:|:-----:|:----------------------------------:|:------:|:----:| 
|1|Connor Sheehan |ansible/hg-ssh: set Lando required list to correct values ( [Bug 1572128](https://bugzilla.mozilla.org/show_bug.cgi?id=1572128)  )I updated this manually during testing, then forgot to updateit after. This lead to the correct value being overridden duringthe following deploy.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=307f3c286876)|2019-08-07 15:45:12
|2|Victor Porof |[Bug 1572072](https://bugzilla.mozilla.org/show_bug.cgi?id=1572072)  - Disable the `format-source` extension since it served it's purpose for Prettier, r=sheehanDifferential Revision: https://phabricator.services.mozilla.com/D40998|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=01ef6e45d821)|2019-08-07 14:25:16
|3|Connor Sheehan |hgext: mark client-side extensions as compatible with Mercurial 5.1 ( [Bug 1569741](https://bugzilla.mozilla.org/show_bug.cgi?id=1569741)  )No changes needed for passing tests in any of these extensions.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=9efa8e908c25)|2019-08-01 22:03:49
|4|Connor Sheehan |configwizard: fix `test-format-source.t` output ( [Bug 1568925](https://bugzilla.mozilla.org/show_bug.cgi?id=1568925)  )Less painful for me to update the test.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=61c65ae8b33b)|2019-08-01 21:23:15
|5|Daniel Holbert |[Bug 1568925](https://bugzilla.mozilla.org/show_bug.cgi?id=1568925)  hgext: Add a newline between 'format-source' descriptive text and yes/no prompt. r=sheehanDifferential Revision: https://phabricator.services.mozilla.com/D40289|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=99dca4809de4)|2019-08-01 20:30:35
|6|Connor Sheehan |mozext: remove extension-loaded `reviewboard` path ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodThis is obviously not needed, and slightly dangerous.Differential Revision: https://phabricator.services.mozilla.com/D40079|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1d53e657414f)|2019-08-01 15:26:51
|7|Connor Sheehan |mozext: use new `templatekeyword` API everywhere ( [Bug 1528938](https://bugzilla.mozilla.org/show_bug.cgi?id=1528938)  ) r=smacleodSince 4.9 has been released, our 4 official supported Mercurialversions are now 4.6-4.9. This allows us to switch off the oldtemplatekeyword decorator API.Differential Revision: https://phabricator.services.mozilla.com/D39945|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=af0808f68d64)|2019-07-31 21:22:35
|8|Connor Sheehan |mozext: remove the `hg cloneunified` command ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodIf you want to `cloneunified` these days, you clonemozilla-unified.Differential Revision: https://phabricator.services.mozilla.com/D39947|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=68c646986378)|2019-07-31 21:22:35
|9|Connor Sheehan |mozext: remove `hg prunerelbranches` command ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodUse the `firefoxtree` extension and the `fxheads` command,and this problem goes away. The solution is much simpler,too.Differential Revision: https://phabricator.services.mozilla.com/D39948|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ed5808efbfc7)|2019-07-31 21:22:35
|10|Connor Sheehan |mozext: remove template keywords related to `aurora` repository ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleod"Aurora" is no longer one of the trains, so we don't need thistemplate keyword.Differential Revision: https://phabricator.services.mozilla.com/D39949|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ae1aa880be83)|2019-07-31 21:22:35
|11|Connor Sheehan |mozext: mark as compatible with Mercurial 5.0 ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodAll these changes get tests passing under Mercurial 5.0.Differential Revision: https://phabricator.services.mozilla.com/D39950|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=39ec9297f750)|2019-07-31 21:22:35
|12|Connor Sheehan |mozext: use extension wrapper mechanism for `hg._peerorrepo` ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodPrevious we did a manual override of this object, which wascausing tracebacks on my machine. Using the extension functionwrapping utility gets rid of the issue.Differential Revision: https://phabricator.services.mozilla.com/D39951|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a8e3d70807b0)|2019-07-31 21:22:35
|13|Connor Sheehan |mozext: remove `bz_available` global variable ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodIt is unused at the moment.Differential Revision: https://phabricator.services.mozilla.com/D39952|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=790b45463fd4)|2019-07-31 21:22:35
|14|Connor Sheehan |mozext: add `hg oops` command from `qbackout` ( [Bug 1565933](https://bugzilla.mozilla.org/show_bug.cgi?id=1565933)  ) r=smacleodIn changeset b3a88dcabb6cccf0 we removed the `mq` related extensionsstill checked in to version-control-tools. It turns out that the`qbackout` extension has a command `hg oops` which is not dependenton `mq` and is used heavily in the sheriffing workflow. This commitmoves the extension into `mozext` to keep it alive for the sheri.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4ed18e15bb10 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4ed18e15bb10)|2019-07-31 21:22:35
|15|Connor Sheehan |mozext: flatten `extsetup` ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodRather than initialize many of the template utilitiesin a conditional block, have the conditional performan early return and keep everything at the top level.Also avoid the double lookup on `disable_local_database`.Differential Revision: https://phabricator.services.mozilla.com/D39954|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c3b65e6e8bfb)|2019-07-31 21:22:35
|16|Connor Sheehan |mozext: unify into a single test and improve coverage ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodThe test coverage for `mozext` was quite lacking, and contributedto a lot of the bit rot in the last few months. In this commit Icreate a single unified test that covers most of the added templatekeywords, revset predicates and commands.Since we rely on the `pushlog` extension to enable several features,we pin the Mercur.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4851a84dfe4d )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4851a84dfe4d)|2019-07-31 21:22:35
|17|Connor Sheehan |mozext: remove `hg pushlogsync` ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodRunning `hg pull` will sync the correct pushlog. Similar to`hg cloneunified`, this command was created in a time beforewe had a unified repo and unified pushlog on hg.mo.Differential Revision: https://phabricator.services.mozilla.com/D39956|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=28b74bc3450b)|2019-07-31 21:22:35
|18|Connor Sheehan |mozext: remove `hg mybookmarks` ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodUsually the bookmarks in a repo are either the users own, orreferences to the various tree heads ( central, inbound, etc ).If the user is using `firefoxtree`, they won't see the fxheadsbookmarks in `hg bookmarks` or `hg show bookmarks` output. Sothis solution is older and can be removed.Differential Revision: https://phabricator.services.mozill.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3e1c648aeb62 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3e1c648aeb62)|2019-07-31 21:22:35
|19|Connor Sheehan |mozext: remove `hg moztrees` ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodAt this point it prints out so much information about somany dead trees that it can't possbly be useful. Usingthe `firefoxtree` extension is highly preferred, wherethere is a `fxheads` command to see the state of varioustrees.Differential Revision: https://phabricator.services.mozilla.com/D39958|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e8bf67866f28)|2019-07-31 21:22:35
|20|Connor Sheehan |mozext: clarify some changes in the docstring ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodDifferential Revision: https://phabricator.services.mozilla.com/D39959|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0e60a3fd0541)|2019-07-31 21:22:35
|21|Connor Sheehan |mozext: miscellaneous fixes ( [Bug 1569734](https://bugzilla.mozilla.org/show_bug.cgi?id=1569734)  ) r=smacleodUse `util.safehasattr` and switch off a dynamic default( this was throwing a devel-warn in testing ).Differential Revision: https://phabricator.services.mozilla.com/D39960|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=5e857d4f3091)|2019-07-31 21:22:35
|22|Connor Sheehan |ansible/hgmo: wrap IRC notification in rescue blockThe IRC notification constantly fails due to the deploybot being unable to join #vcs. Wrap the notificationin a rescue block, so failures are handled gracefully.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6a55c267116a)|2019-07-31 14:17:29
|23|Connor Sheehan |hghooks/lando_required: capture head commit hash instead of base ( [Bug 1569611](https://bugzilla.mozilla.org/show_bug.cgi?id=1569611)  ) r=smacleodAlso set the full URL to the revision with the magic words asextra data in Sentry.Differential Revision: https://phabricator.services.mozilla.com/D39690|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=2d18b6a1ec9d)|2019-07-30 14:02:50
|24|Connor Sheehan |hghooks: remove `test-privileged-push.t`For some reason both `test-privileged-push.t` and `test-lando-required.t`exist in the repo at the same time. Searching my history I can see I ran`hg mv` to rename the file. So I'm not sure what happened here.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=12b76c16ff10)|2019-07-29 18:27:24
|25|Marco Castelluccio |[Bug 1568878](https://bugzilla.mozilla.org/show_bug.cgi?id=1568878)  - Don't try to parse bug IDs aggressively when the source repo is github. r=sheehanDifferential Revision: https://phabricator.services.mozilla.com/D39358|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0d68b0deeca2)|2019-07-25 20:19:57
|26|Connor Sheehan |hghooks/lando_required: don't alert for `scm_allow_direct_push` pushes ( [Bug 1568927](https://bugzilla.mozilla.org/show_bug.cgi?id=1568927)  ) r=smacleodNot doing so causes notifications for Lando landings.Differential Revision: https://phabricator.services.mozilla.com/D39394|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=348072c0e391)|2019-07-25 18:03:19
|27|Connor Sheehan |readonly: add byte string prefixes ( [Bug 1563138](https://bugzilla.mozilla.org/show_bug.cgi?id=1563138)  ) r=globDifferential Revision: https://phabricator.services.mozilla.com/D37822|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e1d74189a807)|2019-07-25 17:38:43
|28|Connor Sheehan |ldap: perform lookup to map email to LDAP DN ( [Bug 1568853](https://bugzilla.mozilla.org/show_bug.cgi?id=1568853)  ) r=smacleodPreviously we created the DN using a format string, however thiswill only be correct when looking up real Mozilla employee entries.Looking up other entities ( namely, bots ) causes no groups to bereturned. This commit adds an extra LDAP lookup to map the emailto the correct DN, which should cause the correct behaviour inboth cases... [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=24c9618eed4a )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=24c9618eed4a)|2019-07-25 16:57:06
|29|Connor Sheehan |TICKscripts: compare threshold against absolute value of measurementIf the value of the message lag is sufficiently negative,there's probably something worth investigating. We saw thiswith [Bug 1567946](https://bugzilla.mozilla.org/show_bug.cgi?id=1567946)  where the Kafka consumers were reportingbeing far behind their expected position. Compare thethreshold against the absolute value of the measurementand we should pick up weird edge cases like this i.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=08f71d165162 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=08f71d165162)|2019-07-25 00:43:24
|30|Connor Sheehan |hghooks/lando_required: disable demandimporter when importing Sentry SDK ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globWhen testing the Lando required hook, I noticed that I wasable to send notifications from the pash virtualenv onhgssh1 using the Python REPL, but could not get the messagethrough to Sentry when performing a push. After some testingI discovered the Sentry SDK does not like Mercurial'sdemandimporter. This co.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=273828b4d8d7 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=273828b4d8d7)|2019-07-24 16:44:17
|31|Connor Sheehan |hghooks/lando_required: refer to most recent topological commit as "head" ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globUsing the term "top" is confusing, since it could refer to eitherthe commit at the "base" of the stack, or the "tip" of the stack.Many VCS' use "head" to refer to a commit with no children,so this commit changes the Lando required hook to use the lessambiguous term.Differential Revision: https://phabricat.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dbfd6ddc0525 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dbfd6ddc0525)|2019-07-24 16:44:17
|32|Connor Sheehan |hghooks/lando_required: avoid double read of Sentry DSN ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globThis is a micro-optimization, but worth doing if we're updatingthe hook anyways. We can also make the logging funcion slightlyflatter with this change.Differential Revision: https://phabricator.services.mozilla.com/D39073|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6cce06c04c63)|2019-07-24 16:44:17
|33|Connor Sheehan |hghooks/lando_required: add more context to Sentry notifications ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globThis commit adds more context to the Sentry event messages.The core message that is displayed in Slack is extended to addthe "justification" for using a manual push, and some unnecesarycruft is removed. The two unique message formats ( one for eachacceptable scm level ) are consolidated into a single messagewith the.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=2a8976cf424a )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=2a8976cf424a)|2019-07-24 16:44:17
|34|Connor Sheehan |ansible/hg-ssh: track correct hosts in `pushdataaggregator_groups` file ( [Bug 1549602](https://bugzilla.mozilla.org/show_bug.cgi?id=1549602)  )These hosts were renamed locally, which caused the Kafkaconsumer group name to change once Ansible was run on them.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3aac07d797c6)|2019-07-23 14:42:45
|35|Connor Sheehan |ansible/hg-ssh-server: change `scm_allow_direct_push` gid to 692 ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=glob`2500` was selected as the `gid` for the new scm groupcompletely at random. Turns out, that value is importantand will block the deploy during creation since it doesn'tmatch the value on the hgssh servers.This commit changes the value to 692, which should fixthe deploy blocker. This is untested but is harmless int.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=83cdb0bd4dcf )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=83cdb0bd4dcf)|2019-07-22 14:32:25
|36|K Lars Lohn |mozhghooks: block pushes to mozilla-central without intentional action ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=sheehanThis hghook will vet pushes to mozilla-central and only allowPushes under these conditions:1 - the user has SCM_ALLOW_DIRECT_PUSH2 - without SCM_ALLOW_DIRECT_PUSH, the tip commit message containsspecific magic words followed by a justificationThe code is written using the "Check" method of writing a hook... [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=f165a1d49900 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=f165a1d49900)|2019-07-19 15:42:20
|37|K Lars Lohn |hg-ssh-server: ldap changes for new scm group ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=sheehanAdds a new scm group called `scm_allow_direct_push`. This intended forthe new PrivilegedPushCheck that will force holders of `scm_level_3` to useLando instead of pushing directly. Holders of `scm_allow_direct_push` willbe allowed to push without justification.Differential Revision: https://phabricator.services.mozilla.com/D3398.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6778c5c94612 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6778c5c94612)|2019-07-19 15:42:20
|38|K Lars Lohn |mozhghooks: integration test for PrivilegedPushCheck ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=sheehanThis new integration tests tries the new PrivilegedPushCheck by exercising eachof the combinations of `scm_level_3` and `scm_allow_direct_push` with variouscommit messages.Differential Revision: https://phabricator.services.mozilla.com/D33980|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3fb3265831d7)|2019-07-19 15:42:20
|39|Connor Sheehan |hghooks: rename privileged push check and change magic words ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globAfter consulting with some engineers from other groups, it waspointed out that the real intent of the magic words and messageis to have the pushing user provide their reason for not usingLando. The "privileges" required for this are not as importantas having the user acknowledge they are going outside therequired proc.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7afaa8a8e1cc )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7afaa8a8e1cc)|2019-07-19 15:42:20
|40|Connor Sheehan |hghooks: move hard-coded string constants to top level ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globThese strings are not required to be class-level constant variables,and their presence within the check class has no functional value.Leaving them in the class requires prefixing `self.` to each useof the variable. This commit moves all the variables to the toplevel and removes many uses of `self`.Differential Revision: htt.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a4f50f7a9240 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a4f50f7a9240)|2019-07-19 15:42:20
|41|Connor Sheehan |hghooks: use `==` for string comparisons ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globThis probably wouldn't have caused any issues in practice,but it's considered more correct to check the strings areequal in value, not identical objects.Differential Revision: https://phabricator.services.mozilla.com/D38486|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=be31a1fbd411)|2019-07-19 15:42:20
|42|Connor Sheehan |hghooks: use same license header as other checks ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=glob`manual_push.py` has a more verbose license header than otherchecks in the same directory.Differential Revision: https://phabricator.services.mozilla.com/D38351|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=de20439d0889)|2019-07-19 15:42:20
|43|Connor Sheehan |hghooks: remove unused import ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globPreviously this was added to define configuration in thecheck file itself, but it was moved to a different file.We also change the import style to multi-line.Differential Revision: https://phabricator.services.mozilla.com/D38352|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=61e67e3f5010)|2019-07-19 15:42:20
|44|Connor Sheehan |hghooks: flatten `ManualPushCheck.check` ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globThe `check` step in the manual push hook included severalnested `if` statements. This commit flattens the functionwhile ensuring the same output, increasing readability.Differential Revision: https://phabricator.services.mozilla.com/D38353|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=17c064383157)|2019-07-19 15:42:20
|45|Connor Sheehan |hghooks: move static methods outside class ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globSeveral methods in `ManualPushCheck` are static and can be movedoutside the class definition.Differential Revision: https://phabricator.services.mozilla.com/D38354|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7acd1ddd0b66)|2019-07-19 15:42:20
|46|Connor Sheehan |hghooks: do not fail when `lando_required_repo_list` config is absent ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globWhen changing the name of the "privileged push" hook, I forgotto update the `docker-hg-ssh` role to modify the correct Ansiblevariable in testing. As a result, the variable was missing fromthe config altogether and many tests were failing. This is becausewe were not checking the return value of `ui.config` be.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7bc74db2d5fe )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7bc74db2d5fe)|2019-07-19 15:42:20
|47|Connor Sheehan |hghooks: fix unit test for lando required check ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globMostly just moving variables to their new locations and removinga few mock `Check` objects that are no longer needed.Differential Revision: https://phabricator.services.mozilla.com/D38356|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=5b46ec42ff31)|2019-07-19 15:42:20
|48|Connor Sheehan |ansible/hg-ssh: set `lando_required_repo_list` to my user repo for testing ( [Bug 1515119](https://bugzilla.mozilla.org/show_bug.cgi?id=1515119)  ) r=globLet's only enable the hook on my user repo, so I can testthe LDAP integration in production.Differential Revision: https://phabricator.services.mozilla.com/D38357|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=25c9bed28326)|2019-07-19 15:42:20
|49|Connor Sheehan |readonly: print `hg serve` error log at end of testWhen something fails inside the `hg serve` process,this will cause it to be printed out in the test.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1e55b3601d0a)|2019-07-12 01:25:29
|50|Connor Sheehan |hgext: remove `checkpystyle` extension ( [Bug 1550748](https://bugzilla.mozilla.org/show_bug.cgi?id=1550748)  ) r=globRemoving this extension as it has not been updated since Mercurial4.2 was released, it is not installed in configwizard and it isnot recommended for use.Differential Revision: https://phabricator.services.mozilla.com/D36206|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a1c86717d010)|2019-07-09 14:21:11
|51|Connor Sheehan |hgext: remove mq related extensions ( [Bug 1550748](https://bugzilla.mozilla.org/show_bug.cgi?id=1550748)  [Bug 1543544](https://bugzilla.mozilla.org/show_bug.cgi?id=1543544)  ) r=globCore `mq` has been deprecated for ages, so our helperextensions should also be deprecated. This commit removesthe `mq` related extensions from version-control-tools.Differential Revision: https://phabricator.services.mozilla.com/D36207|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b3a88dcabb6c)|2019-07-09 14:21:11
|52|Victor Porof |[Bug 1556328](https://bugzilla.mozilla.org/show_bug.cgi?id=1556328)  - hgext: Re-enable format-source, r=andiDifferential Revision: https://phabricator.services.mozilla.com/D33461|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=9c394218cddb)|2019-07-05 13:51:02
|53|Victor Porof |[Bug 1556393](https://bugzilla.mozilla.org/show_bug.cgi?id=1556393)  - hgext: Enable Prettier when running format-source, r=sheehan,andiDifferential Revision: https://phabricator.services.mozilla.com/D33491|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=57ff6e1a400b)|2019-07-05 13:51:02
|54|Victor Porof |[Bug 1563182](https://bugzilla.mozilla.org/show_bug.cgi?id=1563182)  - hgext: Add a new hg extension to run js-format at the commit step, r=andiDifferential Revision: https://phabricator.services.mozilla.com/D36732|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=87bdc08bdd98)|2019-07-05 13:51:02
|55|Victor Porof |[Bug 1563182](https://bugzilla.mozilla.org/show_bug.cgi?id=1563182)  - hgext: Add js-format to the bootstrap process, r=andiDifferential Revision: https://phabricator.services.mozilla.com/D36731|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ad487e509679)|2019-07-05 13:51:02
|56|Connor Sheehan |hgmo: remove wire protocol v2 hacks ( [Bug 1550748](https://bugzilla.mozilla.org/show_bug.cgi?id=1550748)  ) r=smacleodAfter landing much of the wire protocol v2 work upstream, westarted finding lots of bugs and patching over them in v-c-t,with the intent of finding more issues and fix them upstreamafter some experimentation. Since there are no plans to continueworking on this for the time being, I'm removing it, as well assome of the related tests.Differ.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0faaa3ff617b )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0faaa3ff617b)|2019-07-04 17:54:36
|57|Connor Sheehan |mozhg: call new version of `memctx` constructor in other code branch ( [Bug 1546508](https://bugzilla.mozilla.org/show_bug.cgi?id=1546508)  ) r=smacleodMissed this the first time around.Differential Revision: https://phabricator.services.mozilla.com/D36702|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=666175041b7e)|2019-07-04 17:54:36
|58|Connor Sheehan |hgtemplates: allow passing a path `hg` executable to `mozify-templates.py` ( [Bug 1541166](https://bugzilla.mozilla.org/show_bug.cgi?id=1541166)  ) r=smacleodIn a later commit, I will upgrade our copy of the Mercurial testharness for Python 3 compatibility. In doing so, the templatesync test fails as `mozify-templates` no longer uses the versionof `hg` in the test - instead finding the system `hg` and using that.Since my version is 4.5.3 on the server and.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=462e9d604451 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=462e9d604451)|2019-07-04 17:54:36
|59|Connor Sheehan |testing: remove all unnecessary `hghave` files ( [Bug 1562960](https://bugzilla.mozilla.org/show_bug.cgi?id=1562960)  ) r=smacleodRather than having many `hghave` files, each of which is aware ofit's location in the tree, and can find the well-known `hghave.py`file in `testing/`, this commit teaches the slightly modified`run-tests.py` from upstream Mercurial about the location of ourcustom `hghave` script. As part of this change, `testing/hghave.py`needs .. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=70824652e748 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=70824652e748)|2019-07-04 17:54:36
|60|Connor Sheehan |testing: update Mercurial support libraries ( [Bug 1541166](https://bugzilla.mozilla.org/show_bug.cgi?id=1541166)  ) r=smacleodThese libraries have added more support for Python 3compatibility under the new versions.It turns out we have made some modifications to`run-tests.py` that are documented in the commitmessage for 85483f1cae73e27. I have added trackercomments for these changes so they will be easierto spot and preserve in future updates.Differentia.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6e0af7e5a70f )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6e0af7e5a70f)|2019-07-04 17:54:36
|61|Connor Sheehan |mozhg: add byte string prefixes everywhere ( [Bug 1563138](https://bugzilla.mozilla.org/show_bug.cgi?id=1563138)  ) r=smacleodByte-string prefixes will be needed almost everywhere inversion-control-tools. Here we update `mozhg` for Python 3compatibility.Differential Revision: https://phabricator.services.mozilla.com/D36706|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7ede0a306189)|2019-07-04 17:54:36
|62|Connor Sheehan |py3: use `pycompat.getargspec` everywhere ( [Bug 1541166](https://bugzilla.mozilla.org/show_bug.cgi?id=1541166)  ) r=smacleod`inspect.getargspec` has changed under Python 3, and there is a helpervariable in `mercurial.pycompat` that papers over the differences.This commit switches all instances in version-control-tools to use`pycompat.getargspec`. We don't bother changing the single occurancein `pylib/pycodestyle` since that is third party and will likely.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=79a28ff70ead )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=79a28ff70ead)|2019-07-04 17:54:36
|63|Connor Sheehan |push-to-try: add byte string prefixes ( [Bug 1563138](https://bugzilla.mozilla.org/show_bug.cgi?id=1563138)  ) r=smacleodThis commit adds byte-string prefixes to all necessary stringsin the `push-to-try` extension.Differential Revision: https://phabricator.services.mozilla.com/D36708|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=fbe004e04405)|2019-07-04 17:54:36
|64|Connor Sheehan |push-to-try: print generic message about JSON decode error ( [Bug 1541166](https://bugzilla.mozilla.org/show_bug.cgi?id=1541166)  ) r=smacleodGetting the error message from within the `ValueError` or`JSONDecodeError` will require different methods on Python2 and 3, and will produce different outputs on each versionwhen using a solution that is compatible with both versions ( thusrequiring a different output in the test ). Instead, let'sjust print a generic.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dcc3ad8eab7c )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dcc3ad8eab7c)|2019-07-04 17:54:36
|65|Connor Sheehan |ansible/hg-ssh: remove obsolete repositories from `bundle-repos` ( [Bug 1563015](https://bugzilla.mozilla.org/show_bug.cgi?id=1563015)  ) r=smacleodMany of the repos in this list haven't had a new changeset introducedin quite some time, and are unused. No need to generate clone bundlesevery evening and upload them to multiple S3 buckets.Differential Revision: https://phabricator.services.mozilla.com/D36659|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=9632eb71aad5)|2019-07-04 17:48:11
|66|Connor Sheehan |hgwsgi: add `comm-esr68` ( [Bug 1561934](https://bugzilla.mozilla.org/show_bug.cgi?id=1561934)  ) r=smacleodThe repo is already cloned on-disk, this will make it availableover http.Differential Revision: https://phabricator.services.mozilla.com/D36655|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a98a675f7ba9)|2019-07-04 17:19:44
|67|Connor Sheehan |mozautomation: add `comm-esr68` ( [Bug 1561934](https://bugzilla.mozilla.org/show_bug.cgi?id=1561934)  ) r=smacleodDifferential Revision: https://phabricator.services.mozilla.com/D36656|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e1f492423b17)|2019-07-04 17:19:44
|68|Connor Sheehan |ansible/hg-web: add `comm-esr68` to replicationrules ( [Bug 1561934](https://bugzilla.mozilla.org/show_bug.cgi?id=1561934)  ) r=smacleodThis will make the hgweb mirrors in AWS take action on eventsfor the new repo. The rule has already been manually set onthe mirrors to allow the initial clone to replicate.Differential Revision: https://phabricator.services.mozilla.com/D36657|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=9a457bdd76d2)|2019-07-04 17:19:44
|69|Connor Sheehan |docs: remove references to SCL3 ( [Bug 1563223](https://bugzilla.mozilla.org/show_bug.cgi?id=1563223)  )Instead reference MDC1 hosts.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=33ffdacec969)|2019-07-03 15:01:12
|70|Julien Cristau |mozext: add backsoutnodes template keyword ( [Bug 1560446](https://bugzilla.mozilla.org/show_bug.cgi?id=1560446)  ) r=sheehanThis is using the old API and needs to be ported to hg 5.1, but then sodo the other template keywords in mozext.Differential Revision: https://phabricator.services.mozilla.com/D35774|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=842df4a82218)|2019-06-27 13:12:16
|71|Rob Lemley |push-to-try: check for valid try_task_config.json file. r=sheehanWhen using a try_task_config.json file on a try push, try to parse it firstto prevent failures.I added this based on personal experience using this feature. I usually forgetto check first and then the push fails.No attempt it made to ensure the file is valid beyond ensuring it is validJSON that can be loaded by Python's "json" stdlib.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=5f7820c03795 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=5f7820c03795)|2019-06-20 17:43:03
|72|Connor Sheehan |ansible: remove `git` dependency and retrieve `cinnabarclone.py` using `get_url` ( [Bug 1558868](https://bugzilla.mozilla.org/show_bug.cgi?id=1558868)  ) r=globInstalling `git` on the hg hosts in MDC1 fails due to a custom YUM repoadded by the RelOps/IT teams. Instead of blocking the deployment ofcinnabarclone on hgmo as a result of this bug, let's pull down a specificversion of `cinnabarclone` using `get_url`, and deploy that.We make the download of the .. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=da6b5e733005 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=da6b5e733005)|2019-06-20 17:19:51
|73|Connor Sheehan |format-source: enable compatibility with Mercurial 5.0 ( [Bug 1545236](https://bugzilla.mozilla.org/show_bug.cgi?id=1545236)  ) r=andiformat-source was never made compatible with Mercurial 5.0, sincethe extension was disabled on Firefox developer machines. Nowthat we plan to use the extension for a JavaScript reformat using`prettier`, the extension will need to be compatible with newerversions of Mercurial.In this commit we apply compatibility patches fro.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b53f77f17586 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b53f77f17586)|2019-06-13 15:00:50
|74|Connor Sheehan |py3: global replace `iteritems( )` with `items( )` ( [Bug 1541166](https://bugzilla.mozilla.org/show_bug.cgi?id=1541166)  ) r=lars`iteritems( )` doesn't exist in Py3, with `items( )` instead returninga generator by default. This commit switches all instances of theold `iteritems` method with `items`. In all cases except one, wewere evaluating the full list of items regardless of the generatorbased function call, and the instance where we were only returneda s.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6b4c5f3ae719 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6b4c5f3ae719)|2019-06-12 14:40:33
|75|Connor Sheehan |testing: fix tests regressed by 2d01795bd96aA few tests were not updated with the addition of `cinnabarclone`.This commit fixes them.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3ba369fc91d0)|2019-06-10 19:30:59
|76|Connor Sheehan |ansible/ius-repo: install from most recent available repo ( [Bug 1557772](https://bugzilla.mozilla.org/show_bug.cgi?id=1557772)  ) r=globThe outdated IUS repo was identified as the source of thefailure in the attached bug. Installing from the latest fixesthe docker build issues.Differential Revision: https://phabricator.services.mozilla.com/D34239|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=af428d1296fc)|2019-06-10 14:17:00
|77|Mike Hommey |[Bug 1550183](https://bugzilla.mozilla.org/show_bug.cgi?id=1550183)  - Deploy the cinnabarclone extension to the mercurial servers. r=sheehanThe extension comes from https://github.com/glandium/git-cinnabar/blob/master/mercurial/cinnabarclone.pyand has been tested with all mercurial versions from 1.9 to 5.0.Differential Revision: https://phabricator.services.mozilla.com/D30421|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=2d01795bd96a)|2019-06-07 00:14:24
|78|Connor Sheehan |ansible: assign aliases to hosts in Ansible inventoryThis will allow us to use Ansible to run commands on specifichosts without using the IP addresses.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8fe882f771b2)|2019-06-06 19:13:56
|79|Connor Sheehan |pushlog: send `templateutil.date` to template layer instead of raw hg date data ( [Bug 1556018](https://bugzilla.mozilla.org/show_bug.cgi?id=1556018)  ) r=larsSee the bug description for more details. This commit passes the rawMercurial date tuple into a `templateutil.date` object. This will enablethe correct behaviour when displaying the raw output of `pushdate`,and allow formatting with date template keywords and functions.The `showfmt` keyword argument.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=25dcf375258b )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=25dcf375258b)|2019-06-06 16:52:00
|80|Connor Sheehan |pushlog: add new output to `test-pull-obsolete.t` ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globAlso mark as compatible with Mercurial 5.0Differential Revision: https://phabricator.services.mozilla.com/D33846|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0461ff7338e8)|2019-06-06 13:27:26
|81|Connor Sheehan |overlay: rename `copied` keyword argument to `copysource` under 5.0+ ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globAlso mark as compatible with Mercurial 5.0.Depends on D33846Differential Revision: https://phabricator.services.mozilla.com/D33847|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=465163f8a58a)|2019-06-06 13:27:26
|82|Connor Sheehan |hgmo: mark as compatible with Mercurial 5.0 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globOnly a minor test change needed for passing tests. The testin question is related to wire protocol version two, whichcan arguably be removed anyways.Depends on D33847Differential Revision: https://phabricator.services.mozilla.com/D33848|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=cca19bee710d)|2019-06-06 13:27:26
|83|Connor Sheehan |hghooks: enable test compatibility under Mercurial 5.0 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globTests are passing without any changes, with the exception ofa single test which fails due to a changed API used by a helperscript. This commit updates the helper script to use the newAPIs and marks the `hghooks` extension as compatible with5.0.Depends on D33848Differential Revision: https://phabricator.services.mozilla.com/.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=df232910b213 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=df232910b213)|2019-06-06 13:27:26
|84|Connor Sheehan |hgtemplates: run `test-template-sync.t` against Mercurial 5.0.1 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globThis version should always match the version running on hg.mo,which means it needs to be bumped during the upgrade. Runningthis test should tell us if we have any outstanding templateupgrades to perform, and since it passes without issue, wedon't need to make any template changes.Depends on D33849Differential Revis.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4b32cf190f59 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4b32cf190f59)|2019-06-06 13:27:26
|85|Connor Sheehan |hg50: mark many extensions as compatible with Mercurial 5.0 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globNo changes needed to get these extensions passing under 5.0.Depends on D33850Differential Revision: https://phabricator.services.mozilla.com/D33851|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=25a0f6ca4c3b)|2019-06-06 13:27:26
|86|Connor Sheehan |ansible/hg-ssh: upgrade to Mercurial 5.0.1 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globThis commit upgrades Mercurial to 5.0.1 on hgssh in allvirtual environments. This commit should be deployed firstin the upgrade process.Depends on D33852Differential Revision: https://phabricator.services.mozilla.com/D33853|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=55f71016659c)|2019-06-06 13:27:26
|87|Connor Sheehan |ansible/hg-web: upgrade to Mercurial 5.0.1 ( [Bug 1557070](https://bugzilla.mozilla.org/show_bug.cgi?id=1557070)  ) r=globThis commit upgrades Mercurial to 5.0.1 in all virtual environmentson hgweb.Depends on D33853Differential Revision: https://phabricator.services.mozilla.com/D33855|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=cd14589c8543)|2019-06-06 13:27:26
|88|Connor Sheehan |hgext: remove `wireprotocache` extension ( [Bug 1557143](https://bugzilla.mozilla.org/show_bug.cgi?id=1557143)  ) r=globThis extension was to be used as a caching module for wire protocolversion two command responses, in a similar fashion to the cachinglayer used in front of remotefilelog. With the wire protocol workon hold indefinitely, we can remove this half-completed extension.Differential Revision: https://phabricator.services.mozilla.com/D33864|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=06c086758a98)|2019-06-06 13:26:21
|89|Connor Sheehan |pushlog: fix tests regressed by 8edc6d00a988Simply adds the new CSS classes to the test output,and adds a new patch file to the `hgtemplates/.patches`directory.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b03eb039bfcc)|2019-06-05 21:52:17
|90|Connor Sheehan |TICKscript: fix time unit in `try_heads.tick` ( [Bug 1556530](https://bugzilla.mozilla.org/show_bug.cgi?id=1556530)  )Also fix the variable name for the alert node.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0c3c8497e990)|2019-06-05 15:25:48
|91|Connor Sheehan |telegraf: change `1d` to `24h` ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  )Telegraf supports `ns`, `us`, `ms`, `s`, `m` and `h`as units of time - no `d` allowed.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=da1cce9dc5ca)|2019-06-05 14:59:43
|92|Connor Sheehan |hgwsgi: add `mozilla-esr68` ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  ) r=globThe repo was cloned and replicated earlier today, this commitmakes the repo available on hgmo.Differential Revision: https://phabricator.services.mozilla.com/D33371|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=21c2d28dc20d)|2019-06-05 13:50:34
|93|Connor Sheehan |ansible/hg-ssh: generate bundles for mozilla-esr68 ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  ) r=globSo we can clone the new ESR fast in automation and elsewhere.Depends on D33371Differential Revision: https://phabricator.services.mozilla.com/D33372|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=21ad1659be41)|2019-06-05 13:50:34
|94|Connor Sheehan |ansible/hg-ssh: add esr68 to mozilla-unified ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  ) r=globUnified includes all relevant commits in various Firefoxrepositories, and thus should include ESR68.Depends on D33372Differential Revision: https://phabricator.services.mozilla.com/D33373|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3c7eb39555a5)|2019-06-05 13:50:34
|95|Connor Sheehan |mozautomation: add ESR68 ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  ) r=globThis commit adds ESR68 to all the required locationsin `mozautomation`.Depends on D33373Differential Revision: https://phabricator.services.mozilla.com/D33374|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1852d1d7a0d5)|2019-06-05 13:50:34
|96|Connor Sheehan |ansible/hg-web: add esr68 to `replicationrules` and remove esr52 ( [Bug 1555777](https://bugzilla.mozilla.org/show_bug.cgi?id=1555777)  ) r=globWe will need to have a copy of ESR68 on the mirrors, and thusit need to be added to the mirror replication rules. ESR52 hasreached EOL, so it has been removed.Differential Revision: https://phabricator.services.mozilla.com/D33375|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=79d8b8bd4bd5)|2019-06-05 13:50:34
|97|Connor Sheehan |telegraf: add an `exec` plugin to report the number of heads on try ( [Bug 1556530](https://bugzilla.mozilla.org/show_bug.cgi?id=1556530)  ) r=globThis commit adds a Telegraf `exec` input plugin to monitor thenumber of heads on the try repo on hgssh. The command is a callto `hg log`, taking a call to the `revset` template function andpassing it through the `count` template filter to get the numberof revisions in the specified revset ( in this case, `head( ).. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3ae4efdfac68 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3ae4efdfac68)|2019-06-05 13:50:05
|98|Connor Sheehan |TICKscripts: add alert for too many try heads ( [Bug 1556530](https://bugzilla.mozilla.org/show_bug.cgi?id=1556530)  ) r=globIn the previous commit we added reporting for the number ofheads on try, and in this commit we tell Kapacitor to send aSlack alert in the event we cross 40000/50000 heads ( as a warningand critical alert, respectively ). This script is checked in toversion-control-tools with the other alerting scripts for trackingpurposes but will nee.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b793a0142828 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b793a0142828)|2019-06-05 13:50:05
|99|Tom Prince |No bug: Show relative time for push date on `/rev/`; r=sheehanDifferential Revision: https://phabricator.services.mozilla.com/D33366|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8edc6d00a988)|2019-06-03 16:48:07
|100|Connor Sheehan |ansible: remove `ci-{ec1,ue2}` hostgroups ( [Bug 1553885](https://bugzilla.mozilla.org/show_bug.cgi?id=1553885)  )These have been torn down.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=d12b6b56fec5)|2019-05-28 16:56:15
|101|Connor Sheehan |hghooks: update `test-prevent-webidl-changes.t` ( [Bug 1554853](https://bugzilla.mozilla.org/show_bug.cgi?id=1554853)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=04fd22c76ae7)|2019-05-28 14:54:00
|102|Peter Van der Beken |[Bug 1554853](https://bugzilla.mozilla.org/show_bug.cgi?id=1554853)  - Update DOM peers list in prevent_webidl_changes.py. r=sheehan?Differential Revision: https://phabricator.services.mozilla.com/D32797|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3c51465f9f92)|2019-05-28 14:48:22
|103|Connor Sheehan |terraform: tear down AWS resources in `eu-central-1` and `us-east-2` ( [Bug 1553885](https://bugzilla.mozilla.org/show_bug.cgi?id=1553885)  ) r=dustinWhile these regions have a Gecko workers VPC available,it appears there are no workers configured to run in them.In this commit we tear down the hgmo VPC in the same regions.We can easily stand up the VPCs again if we set up workers inthose regions.Differential Revision: https://phabricator.services.mozilla... [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dfdbe16c8faa )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=dfdbe16c8faa)|2019-05-27 17:48:51
|104|Connor Sheehan |TICKscripts: update alerts and add alerting for KafkaHere we add alerting for the absence of Kafka processes onour broker hosts, change the alerts to only fire on statechanges every 2 minutes, and bold some of the text in thealert message.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=d99210e8b88f)|2019-05-27 17:46:01
|105|Connor Sheehan |ansible/hg-web: add cedar project repo to `replicationrules` ( [Bug 1554307](https://bugzilla.mozilla.org/show_bug.cgi?id=1554307)  )I noticed this was missing when Kapacitor started firing offconsumer lag alerts, but only for the on-premises nodes.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=af4e16b5aa36)|2019-05-24 20:34:04
|106|Connor Sheehan |TICKscripts: alert on state changes only with 2 minute windowCurrently the TICKscript alerts continuously fire every timea new data point reaches Kapacitor. With this change the alertswill only go off once, then wait for 2 minutes before firingagain if the alert is in the same state. All state changes( ie warning -> critical or anything -> OK ) will still fire analert.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=20fc9edb1c22)|2019-05-24 20:34:04
|107|Connor Sheehan |ansible/hg-web: remove filter for sheehan's user repo ( [Bug 1553319](https://bugzilla.mozilla.org/show_bug.cgi?id=1553319)  )Left over from development/testing.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=fb153bf90ccb)|2019-05-22 15:02:49
|108|Connor Sheehan |ansible/hg-web: add Thunderbird release repos to replication filters ( [Bug 1553323](https://bugzilla.mozilla.org/show_bug.cgi?id=1553323)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=b85b908567bf)|2019-05-22 15:02:49
|109|Connor Sheehan |TICKscripts: increase thresholds in `vcsreplicator_consumer_lag.tick`The Slack alerts were happening too frequently to be actionable.Here we increase the thresholds to a level high enough that analert should require action.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0a3096a899ce)|2019-05-17 14:51:23
|110|Connor Sheehan |ansible: declare `ansible_{sudo,become}` as hostgroup variables|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=eedbbe051557)|2019-05-15 17:08:31
|111|Connor Sheehan |ansible: move eu-central-1 hosts to hgweb-mirrors hostgroup|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=fdb441baf69a)|2019-05-15 17:08:31
|112|Connor Sheehan |ansible/hg-ssh: add `autoland` to mozilla-unified ( [Bug 1551274](https://bugzilla.mozilla.org/show_bug.cgi?id=1551274)  ) r=smacleodThis commit adds the `autoland` repository to the set of repositoriesin mozilla-unified. The tip revision of this repository will havea bookmark named `autoland` at it's tip revision, copying the sectionname in the config file. Since all new commits will be on the defaultbranch, we limit the pulled revisions to that branch.D.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=57918871a6c0 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=57918871a6c0)|2019-05-15 16:49:16
|113|Connor Sheehan |ansible: use correct IPs for eu-central-1 hosts ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )My merge went awry and the hosts weren't updated. This commitsets the IPs to the correct value.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c1c4a668367b)|2019-05-14 20:49:59
|114|Connor Sheehan |ansible: fix `bootstrap_hostname` for eu-central-1 mirrors ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c72925f6b17c)|2019-05-14 20:31:44
|115|Connor Sheehan |ansible/hg-ssh-server: add `sentry-sdk` to `venv_pash` ( [Bug 1550755](https://bugzilla.mozilla.org/show_bug.cgi?id=1550755)  ) r=larsThis commit adds `sentry-sdk` to the pash virtualenvon the hgssh servers.Differential Revision: https://phabricator.services.mozilla.com/D30654|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=d18e8a095ea4)|2019-05-14 16:05:20
|116|Connor Sheehan |terraform: stand up private hg service in us-east-2 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e3dce3f0d26a)|2019-05-14 14:31:56
|117|Connor Sheehan |ansible: move us-east-1 hosts to hgweb-mirrors hostgroup and us-east-2 hosts to bootstrap group ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=cbfd7f665c0f)|2019-05-14 14:31:56
|118|Connor Sheehan |ansible: split `hgweb-mirrors` into regional subgroups ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )Previously we had a single group with comments denotingthe different regions. Now we can reference hosts in theindividual regions by their hostgroup. This will allow usto use Ansible to run commands on machines in various AWSregions with ease.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0bf07df77731)|2019-05-14 14:31:56
|119|Connor Sheehan |bootstrap: run `hg replicatehgrc` for try repos on correct host ( [Bug 1550782](https://bugzilla.mozilla.org/show_bug.cgi?id=1550782)  )This command was being run on the new hgweb machine, insteadof the hgssh master host. Oops!|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=64b81e9c817b)|2019-05-14 14:31:56
|120|Connor Sheehan |ansible: move newly bootstrapped hosts in `ci-ue2` hostgroup ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4c5a2e4076a4)|2019-05-14 14:31:56
|121|Connor Sheehan |terraform: stand up private hg service in eu-central-1 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4588772ce1ae)|2019-05-14 14:31:56
|122|Connor Sheehan |terraform: add AMI ID for CentOS7 in eu-central-1 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )The CentOS7 AMI ID for eu-central-1 was never added to theregional mapping. This commit adds the new region andre-formats the whitespace.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=09eac4fb3815)|2019-05-14 14:31:56
|123|Connor Sheehan |bootstrap: add us-east-2 hosts to bootstrap hostgroup ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ccc7fbade54f)|2019-05-14 14:31:56
|124|Connor Sheehan |bootstrap: fix file permissions on `instance_data.json` during bootstrap ( [Bug 1550782](https://bugzilla.mozilla.org/show_bug.cgi?id=1550782)  )Something in the bootstrap procedure sets ownership of thisfile from `hg:hg` to `1001:1002` during the bootstrapplaybook. Here we reset the permissions to the desiredstate once bootstrapping is complete.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=663cd30b7a27)|2019-05-14 14:31:56
|125|Connor Sheehan |terraform: do not create new ec2 resource when `user_data` changesChanges to user data shouldn't create a new resource. Anyuser data changes will be manually applied to the extra mirrorsas needed.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=13f70d71ae3a)|2019-05-13 17:36:05
|126|Connor Sheehan |terraform: stand up private hg service in us-east-1 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ca6924b0110d)|2019-05-13 17:36:05
|127|Connor Sheehan |ansible: add us-east-1 hosts to bootstrap hostgroup ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c5cdceaf4de3)|2019-05-13 17:36:05
|128|Connor Sheehan |ansible/bootstrap: set hostname based on hostgroup variable during bootstrap|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=91edbf180dfb)|2019-05-13 17:36:05
|129|K Lars Lohn |hgext: update deprecated call to ui.progress ( [Bug 1550175](https://bugzilla.mozilla.org/show_bug.cgi?id=1550175)  ) r=sheehanFor the extension `overlay`, the call to `ui.progress` was just replaced`ui.makeprogress`. This is justified by the declaration in `overlay`requiring HG47 or later. Since `ui.makeprogress` was introduced in HG47,this seem justified.For the extension `mozext`, since I know nothing of what versions ofHG will be used, a local funct.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=342896d12d09 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=342896d12d09)|2019-05-10 18:48:11
|130|Connor Sheehan |ansible: add new hosts in `us-west-1` to `hgweb-mirrors` hostgroup ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )These have been bootstrapped and are serving production traffic.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=858555769242)|2019-05-10 16:39:32
|131|Connor Sheehan |ansible/bootstrap: turn off Telegraf during bootstrap procedure ( [Bug 1550777](https://bugzilla.mozilla.org/show_bug.cgi?id=1550777)  )Keeping the agent on causes lots of unnecessary alerts inthe #vcs Slack channel.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1fa8a029c136)|2019-05-10 16:39:32
|132|Connor Sheehan |ansible/bootstrap: run `hg replicatehgrc` on try repos after running a stream clone ( [Bug 1545387](https://bugzilla.mozilla.org/show_bug.cgi?id=1545387)  )See [Bug 1545387](https://bugzilla.mozilla.org/show_bug.cgi?id=1545387)  comment 7 for more on why we need this change.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=f98ead5d399d)|2019-05-10 16:39:32
|133|Connor Sheehan |terraform: run `chown` recursively on full `/var/hg` directory instead of `instance_data.json` ( [Bug 1550782](https://bugzilla.mozilla.org/show_bug.cgi?id=1550782)  )Previously we only ran `chown` on the instance data object,leaving `/var/hg` owned by `root`. Then when Ansible overwritesthe permissions to make `hg` the owner, the instance dataobject has it's permissions corrupted.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3a3df759c32c)|2019-05-10 16:39:32
|134|Connor Sheehan |terraform: upgrade mirror instances to `c5d.2xlarge`The instances were previously set to this type, but Imoved them down as they could handle the traffic.Unfortunately when project repos like `larch` or `maple`need to pull, the increased amount of CPU required tocalculate the response multiplied by the number ofresponses that must be generated create too much load.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6e41162eed29)|2019-05-09 15:02:15
|135|Connor Sheehan |terraform: set `ebs_optimized = true` for hgweb mirrors|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=6cd9df449844)|2019-05-09 15:02:15
|136|Connor Sheehan |ansible: update bootstrap hostsTerraform changes required me to re-create the machines.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=33aa6d00f3c3)|2019-05-09 15:02:15
|137|Connor Sheehan |ansible/hg-ssh-server: do not install `ldap_helper.py` in pash setup ( [Bug 1547755](https://bugzilla.mozilla.org/show_bug.cgi?id=1547755)  )Doing so causes install to fail, when it is available in thepash virtualenv from hgmolib.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=60e5485f114b)|2019-05-09 13:54:32
|138|Connor Sheehan |ansible: add new hosts to bootstrap hostgroup ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e63c96151e7d)|2019-05-08 18:19:02
|139|K Lars Lohn |pash: Move ldap_helper from pash to hgmolib ( [Bug 1547755](https://bugzilla.mozilla.org/show_bug.cgi?id=1547755)  ) r=sheehanThis allows using the LDAP module in code other than just pash.Differential Revision: https://phabricator.services.mozilla.com/D30379|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=aa66da08bd4d)|2019-05-08 17:52:40
|140|Connor Sheehan |terraform: add "to-mdc" search term in `aws_vpn_gateway` data source ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackPreviously we searched for "to-mdc's". The new gateway onlylinks back to one of the datacentres, so keeping the name whileselecting the correct connection seems like the correct way tohandle this.Differential Revision: https://phabricator.services.mozilla.com/D30292|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=f250d8415b45)|2019-05-08 17:35:55
|141|Connor Sheehan |terraform: remove subnets in availability zone C ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackTurns out, us-west-1 doesn't have an availability zone C. Thiswas mentioned to me during review, and I thought I checked eachregion to ensure there was a third AZ for each, but apparentlythe way I checked was wrong. Oops!Considering we aren't using the subnet in that AZ at the momentany way, this isn't a huge deal. So this comm.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4172e809ba0e )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=4172e809ba0e)|2019-05-08 17:35:55
|142|Connor Sheehan |terraform: remove security group rule allowing Telegraf traffic from MDC1 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackThis rule was previously in place to allow our on-premises hoststo send data to the test InfluxDB instance. Now that we have theproduction service online, we can remove it.Differential Revision: https://phabricator.services.mozilla.com/D30294|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=19a3a9e03887)|2019-05-08 17:35:55
|143|Connor Sheehan |terraform: rename Route53 record variable to be region agnostic ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackThe Terraform variable name included "uw2", short for"us-west-2". Now that we are deploying to more regions,it should be changed.Differential Revision: https://phabricator.services.mozilla.com/D30295|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=64e8e9a62933)|2019-05-08 17:35:55
|144|Connor Sheehan |terraform: create unique certificate per region ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackThe previous plan was to create a single certificate that wouldbe shared across AWS regions, but we have since learned thatACM certificates are per-region only. So this commit moves thecertificate resource definition from the `main.tf` file for theentire Terraform config and into the `aws-vpc` modules for eachspecific AWS region.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c6ea6220b09d )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=c6ea6220b09d)|2019-05-08 17:35:55
|145|Connor Sheehan |terraform: stand up AWS VPC environment in us-west-1 ( [Bug 1548302](https://bugzilla.mozilla.org/show_bug.cgi?id=1548302)  ) r=bstackNow that our environment is reproducible in different AWS regions,this commit creates a new instance of the `aws-vpc` modules for usein us-west-1.Differential Revision: https://phabricator.services.mozilla.com/D30297|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0ac1bb96d120)|2019-05-08 17:35:55
|146|Connor Sheehan |ansible/hg-ssh: track `pushdataaggregator_groups` file under version control ( [Bug 1549724](https://bugzilla.mozilla.org/show_bug.cgi?id=1549724)  ) r=larsThis file currently lives on the hgssh shared NFS mount, and isuntracked by version control.Differential Revision: https://phabricator.services.mozilla.com/D30221|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1e05f401fe4f)|2019-05-08 14:35:33
|147|Connor Sheehan |hg50: mark several extensions as compatible with Mercurial 5.0 ( [Bug 1545236](https://bugzilla.mozilla.org/show_bug.cgi?id=1545236)  ) r=larsThese extensions all pass under the release candidatewithout any test changes.Differential Revision: https://phabricator.services.mozilla.com/D28563|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=3e6170e6eced)|2019-05-08 14:17:32
|148|Connor Sheehan |serverlog: update number of bytes served in test output after 40-char SHA patch ( [Bug 1548149](https://bugzilla.mozilla.org/show_bug.cgi?id=1548149)  ) r=larsThe number of bytes served has changed after making hgmoserve the 40-character SHA by default. It's not a breakingchange, so it's not a huge deal, but I'm still investigatingthe cause.Differential Revision: https://phabricator.services.mozilla.com/D29443|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=72bf13cdc44e)|2019-05-07 16:15:15
|149|Connor Sheehan |ansible/monitoring-agent: remove `influxdb` test instance output module ( [Bug 1548865](https://bugzilla.mozilla.org/show_bug.cgi?id=1548865)  ) r=globThis commit makes the Telegraf reporting agent no longer sendoutput data to the test InfluxDB instance.Differential Revision: https://phabricator.services.mozilla.com/D29845|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=96ccae6376a2)|2019-05-06 17:11:52
|150|Connor Sheehan |ansible: remove `monitoring-host` role and move TICKscripts elsewhere ( [Bug 1548865](https://bugzilla.mozilla.org/show_bug.cgi?id=1548865)  ) r=globThis role was used to configure the test InfluxDB instance,which is no longer needed since the production service isavailable for use.The TICKscripts should still be tracked under versioncontrol, so I've moved them under the `scripts` directory.I'd like to find a way to automatically update the scriptsin Kapa.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8d6e7d5e183b )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8d6e7d5e183b)|2019-05-06 17:11:52
|151|Connor Sheehan |terraform: remove monitoring host from `aws-vpc` config ( [Bug 1548865](https://bugzilla.mozilla.org/show_bug.cgi?id=1548865)  ) r=bstackAll traffic is now being sent to the production instance, sowe no longer need this test machine.Differential Revision: https://phabricator.services.mozilla.com/D29847|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=70d5c046a40e)|2019-05-06 17:11:52
|152|Jed Davis |hghooks: update IPC peer list to add nika, remove former peers, and fix my name ( [Bug 1548966](https://bugzilla.mozilla.org/show_bug.cgi?id=1548966)  ) r=sheehanDifferential Revision: https://phabricator.services.mozilla.com/D29923|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7c70357a7182)|2019-05-06 14:53:04
|153|Connor Sheehan |obsolescencehacks: mark as compatible with Mercurial 4.9 ( [Bug 1513273](https://bugzilla.mozilla.org/show_bug.cgi?id=1513273)  )Tests pass, we simply overlooked the compatible version bump.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=1e8f278de369)|2019-05-06 14:10:31
|154|Connor Sheehan |ansible/monitoring-agent: add monitoring of Kafka/Zookeeper processes ( [Bug 1548266](https://bugzilla.mozilla.org/show_bug.cgi?id=1548266)  ) r=globWe'd like to add monitoring of our Kafka brokers to the`monitoring-agent` Ansible role. In this commit we createa new `kafka.conf.j2` template which will include allTelegraf plugins used to monitor Kafka, and include thetemplate in our Telegraf config on the condition theKafka host is in our `zk_servers` `hgm.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=222d1e4907cb )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=222d1e4907cb)|2019-05-06 13:44:20
|155|Connor Sheehan |hgtemplates: wrap instances of `author` template keyword with `mailmap` function ( [Bug 1464838](https://bugzilla.mozilla.org/show_bug.cgi?id=1464838)  ) r=globMercurial has an implementation of Git's `mailmap` available as atemplate function. I added the implementation as a way of easingmy way into learning the Mercurial codebase. This commit performsa regex replace of `{author` with `{mailmap( author )` everywherein `gitweb_mozilla`, and adds the associat.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a91af8a784ee )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a91af8a784ee)|2019-05-06 13:43:36
|156|Connor Sheehan |pushlog: fix tests regressed by 40-character node patch ( [Bug 1548054](https://bugzilla.mozilla.org/show_bug.cgi?id=1548054)  ) r=larsA few tests were overlooked when changing `gitweb_mozilla`to display 40-character SHAs. This commit fixes those tests.Differential Revision: https://phabricator.services.mozilla.com/D29397|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=d9911e62f3a4)|2019-04-30 20:55:39
|157|Connor Sheehan |ansible/monitoring-agent: remove retention policy from database name ( [Bug 1543989](https://bugzilla.mozilla.org/show_bug.cgi?id=1543989)  )We only need the database name in this field.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=2a93b060dd7e)|2019-04-30 17:39:20
|158|Connor Sheehan |ansible/monitoring-agent: remove quotes around boolean variable ( [Bug 1543989](https://bugzilla.mozilla.org/show_bug.cgi?id=1543989)  )This causes the variable to be a string instead of a bool.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=f13310e10021)|2019-04-30 16:25:39
|159|Connor Sheehan |ansible/monitoring-agent: fix production InfluxDB credentials ( [Bug 1543989](https://bugzilla.mozilla.org/show_bug.cgi?id=1543989)  )The production URL for Mozilla's InfluxDB instance wasincorrect, as well as the database name being enclosedby too many quotes.The `influxdb_skip_database_creation` variable is alsoadded as `True` ( valid in Python ) instead of `true`( valid JSON/TOML ), so we add a `to_json` filter tothat variable.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=d7b0532a4e6a)|2019-04-30 16:09:51
|160|Connor Sheehan |robustcheckout: remove arguments passed to `matchmod.always` in modern Mercurial ( [Bug 1546507](https://bugzilla.mozilla.org/show_bug.cgi?id=1546507)  ) r=globThe arguments passed to `matchmod.always` are unused under thehood, so they've been removed in Mercurial 5.0 and onward.Differential Revision: https://phabricator.services.mozilla.com/D29271|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=88247fb4308a)|2019-04-30 15:53:54
|161|Connor Sheehan |ansible/monitoring-agent: add encrypted InfluxDB credentials ( [Bug 1543989](https://bugzilla.mozilla.org/show_bug.cgi?id=1543989)  ) r=larsThis commit adds a set of default Ansible variables in the`monitoring-agent` role, for sending data to Mozilla'sproduction InfluxDB instance.Since `sops` doesn't yet know how to parse TOML, we storethe secrets as YAML Ansible defaults.Differential Revision: https://phabricator.services.mozilla.com/D28363|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=baa4bb1271e8)|2019-04-30 15:03:56
|162|Connor Sheehan |ansible/monitoring-agent: send monitoring data to production InfluxDB instance ( [Bug 1543989](https://bugzilla.mozilla.org/show_bug.cgi?id=1543989)  ) r=larsThis commit tells Telegraf to send data to the production InfluxDBinstance. At the moment we will send data to both the test instanceand the production instance, to verify all the data is correctlysent.Differential Revision: https://phabricator.services.mozilla.com/D28364|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=32df72677efb)|2019-04-30 15:03:56
|163|Connor Sheehan |hgtemplates: pass `node` through `short` template filter for `data-node` HTML tag ( [Bug 1547870](https://bugzilla.mozilla.org/show_bug.cgi?id=1547870)  ) r=globNot passing the node through `short` causes a `querySelector`call in `mercurial.js` to return nothing. This call is responsiblefor applying left padding to the element, to allow the graphto display without the changeset information on top.Differential Revision: https://phabricator.services.mozilla.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=41e63de62c96 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=41e63de62c96)|2019-04-30 15:00:40
|164|Connor Sheehan |mozhg: use renamed keyword argument when running under Mercurial >= 5.0 ( [Bug 1546508](https://bugzilla.mozilla.org/show_bug.cgi?id=1546508)  ) r=globUnder Mercurial 5.0, the `copied` keyword argument passedto `context.memfilectx` has been renamed to `copysource`.This commit adds a conditional to use the correct argumentname when running under the new version.Differential Revision: https://phabricator.services.mozilla.com/D29212|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=ae489559efe1)|2019-04-29 15:44:11
|165|Connor Sheehan |push-to-try: mark as compatible with Mercurial 5.0 ( [Bug 1546508](https://bugzilla.mozilla.org/show_bug.cgi?id=1546508)  ) r=globWith `mozhg` now compatible with the 5.0 release candidate,`push-to-try` tests pass under the new version.Differential Revision: https://phabricator.services.mozilla.com/D29213|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=db9bc20ab995)|2019-04-29 15:44:11
|166|Connor Sheehan |hgtemplates: do not pass `node` through `short` template filter anywhere ( [Bug 1539324](https://bugzilla.mozilla.org/show_bug.cgi?id=1539324)  ) r=globTreeherder has removed support for using 12 character revisionSHAs, due to the performance hit taken by being unable to fullyindex a 12 character SHA ( since the 40 character SHA is thecanonical version ). This commit performs a global replace of`{node|short}` with `{node}` for the `gitweb_mozilla` theme.The.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=51905dc214c4 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=51905dc214c4)|2019-04-29 13:50:05
|167|Connor Sheehan |hgserver: add `sparserevlog` capability to `test-obsolescence-server.t` ( [Bug 1547276](https://bugzilla.mozilla.org/show_bug.cgi?id=1547276)  )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=0ec322c77f23)|2019-04-26 15:21:03
|168|Connor Sheehan |hgserver: add `sparserevlog` bundle requirement to `test-clonebundles.t` ( [Bug 1547276](https://bugzilla.mozilla.org/show_bug.cgi?id=1547276)  )New bundles under 4.9.1 include the `sparserevlog` requirement.Since none of the repos on hgmo are in the `sparserevlog` formatyet, this is just extra test output we need to add. It doesn'taffect behaviour in any way.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=58286127f121)|2019-04-26 15:21:03
|169|Connor Sheehan |hgserver: add `reposetup` timing output to `test-push-basic.t` blackbox logs ( [Bug 1547276](https://bugzilla.mozilla.org/show_bug.cgi?id=1547276)  )Mercurial 4.9.1 now includes repo setup timing information inblackbox logs, which we have yet to add to the tests.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=e8a3e082d629)|2019-04-26 15:21:03
|170|Connor Sheehan |ansible/monitoring-agent: only modify httpd access log permissions when `hosttype` is "hgweb"hgssh doesn't install Apache, so there's no log to modify.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=210ad037e038)|2019-04-24 15:04:18
|171|Connor Sheehan |ansible/monitoring-agent: use `elif` instead of `else` in Jinja2 templateAlso use double quotes to indicate a string.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=bdc17e270d0b)|2019-04-23 20:22:41
|172|Connor Sheehan |terraform: allow MDC1 hosts to send traffic to InfluxDB test instance ( [Bug 1545434](https://bugzilla.mozilla.org/show_bug.cgi?id=1545434)  )Forgot to add these new hosts to the security group rule.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=a9512159265c)|2019-04-23 19:38:14
|173|Connor Sheehan |ansible/monitoring-agent: move `hgweb` specific components behind a variable ( [Bug 1545434](https://bugzilla.mozilla.org/show_bug.cgi?id=1545434)  ) r=smacleodThis way we can deploy our Telegraf config to hgssh,and monitor host-specific things ( such as aggregatorlag on hgssh, consumer lag on hgweb, etc ).Differential Revision: https://phabricator.services.mozilla.com/D28150|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=fae277edab13)|2019-04-23 19:28:01
|174|Connor Sheehan |vcsreplicator: add `--telegraf` flag to aggregator lag check ( [Bug 1545434](https://bugzilla.mozilla.org/show_bug.cgi?id=1545434)  ) r=smacleodThis commit adds a `--telegraf` flag to the aggregator lag checkscript running on hgssh. When the script is run with this flag,the output will be formatted as JSON, consumable by Telegraf's`exec` plugin. With this flag added, we will be able to sendaggregator lag data to InfluxDB for monitoring/alerting purposes.D.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7853f082ab09 )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=7853f082ab09)|2019-04-23 19:28:01
|175|Connor Sheehan |ansible/monitoring-agent: add `hgssh` specific plugins to Telegraf config ( [Bug 1545434](https://bugzilla.mozilla.org/show_bug.cgi?id=1545434)  ) r=smacleodThis commit adds a `hgssh` specific set of configuration optionsto the Telegraf configuration file. At the moment we track thelag of the "aggregator" replication daemons, and the presenceof processes for those daemons. We also apply the `monitoring-agent`role in the hgssh deploy playbook and set `hgss.. [continue reading]( https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8644eae3410c )|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=8644eae3410c)|2019-04-23 19:28:01
|176|Connor Sheehan |terraform: remove `hgmointernal.com` Route53 private hosted zoneWe switched to a public hosted zone instead, so the privatezone is no longer needed.|[URL](https://hg.mozilla.org/hgcustom/version-control-tools/pushloghtml?changeset=675b07956340)|2019-04-23 19:26:29
